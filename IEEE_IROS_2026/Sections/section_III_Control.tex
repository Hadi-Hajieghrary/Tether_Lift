% !TEX root = ../Main.tex
GPAC is a four-layer hierarchical controller assigning each physical degree of freedom to a control layer at progressively higher bandwidth (Fig.~\ref{fig:architecture}). Each agent~$i$ receives only: (i)~a shared trajectory~$p_d(t)$ broadcast before flight, (ii)~its own IMU/GPS/barometer measurements, and (iii)~local cable tension $T_i$ and direction $q_i$. Payload position is obtained via GPS broadcasts at 10\,Hz. No payload state, other cable states, or centralized coordinator is required. The control layers (1--3) require no inter-agent state exchange; only neighbor GPS positions are shared at 10\,Hz for collision avoidance (Layer~4), and the desired heading $\psi_d$ is part of the pre-broadcast trajectory parameters.

\begin{figure}[t!]
\centering
\resizebox{0.92\columnwidth}{!}{%
\begin{tikzpicture}[
  block/.style={draw, rounded corners=2pt, minimum width=3.0cm, minimum height=0.65cm, font=\footnotesize, align=center},
  arr/.style={-{Stealth[length=2mm]}, thick},
  every node/.style={font=\footnotesize}
]
  \node[block, fill=blue!10] (L1) {Layer 1: Position\\+ Anti-Swing (50\,Hz)};
  \node[block, fill=red!10, below=0.35cm of L1] (CBF) {CBF Safety Filter\\(200\,Hz)};
  \node[block, fill=blue!10, below=0.35cm of CBF] (L2) {Layer 2: Attitude\\on SO(3) (200\,Hz)};
  \node[block, fill=teal!10, right=1.2cm of L1] (L3) {Layer 3: Mass\\Estimator (50\,Hz)};
  \node[block, fill=teal!10, right=1.2cm of CBF] (L4) {Layer 4:\\ESO ($\omega_0\!=\!50$)};
  \node[block, fill=green!8, right=1.2cm of L2] (ESKF) {ESKF Sensor\\Fusion (200\,Hz)};
  \node[block, fill=gray!10, below=0.35cm of L2, minimum width=7.2cm] (plant) {Quadrotor$_i$ + Bead-Chain Cable + Payload};
  \draw[arr] (L1) -- node[left, font=\scriptsize]{$F_{\text{des}},\; R_d$} (CBF);
  \draw[arr] (CBF) -- node[left, font=\scriptsize]{$f_{\text{safe}},\; R_d^{\text{safe}}$} (L2);
  \draw[arr] (L2) -- node[left, font=\scriptsize]{$\tau_i,\; f_i$} (plant);
  \draw[arr] (L3) -- node[above, font=\scriptsize]{$\hat{\theta}_i$} (L1);
  \draw[arr] (L4) -- node[above, font=\scriptsize]{$\hat{d}_i$} (CBF);
  \draw[arr] (ESKF) -- node[above, font=\scriptsize]{$\hat{p},\hat{v}$} (L4);
  \draw[arr, dashed] (ESKF.north) -- ++(0,0.55) -| (L1.east);
  \draw[arr, dashed, gray] (plant.east) -- ++(0.3,0) |- node[right, near start, font=\scriptsize, text=gray]{sensors} (ESKF.south);
\end{tikzpicture}
}
\caption{GPAC per-agent architecture. Blue: control cascade. Red: CBF overlay. Teal: estimation. Green: sensor fusion. Each agent executes independently; only neighbor GPS positions are exchanged (for collision avoidance).}
\label{fig:architecture}
\end{figure}

\subsection{Geometric Error Functions}

The singularity-free error functions are:
\begin{align}
  e_{R_i} &= \tfrac{1}{2}(R_{d_i}^\top R_i - R_i^\top R_{d_i})^\vee, \label{eq:eR}\\
  \Psi_{q_i} &= 1 - q_{d_i} \cdot q_i \in [0,2], \label{eq:psi_q}\\
  e_{q_i} &= P(q_i)\,q_{d_i} \in T_{q_i}\Sph^2, \label{eq:eq}
\end{align}
where $e_{R_i}$ is the attitude error on $\SOthree$~\cite{lee2010geometric}, $\Psi_{q_i}$ is the cable configuration error on $\Sph^2$~\cite{lee2018geometric}, and $e_{q_i}$ is the negative gradient of $\Psi_{q_i}$ restricted to the tangent space $T_{q_i}\Sph^2$. These are used throughout the control and safety layers that follow.

\subsection{Layer 1: Position Tracking and Anti-Swing Control}

The outermost layer ($\sim$50\,Hz) computes the total desired force as a sum of feedback, feedforward, cable compensation, anti-swing, and ESO terms:
\begin{equation*}
  F_{\text{des},i} = F_{\text{fb},i} + F_{\text{ff},i} + F_{\text{cable},i} + F_{\text{swing},i} + F_{\text{eso},i}.
\end{equation*}
PID tracking feedback with per-axis anti-windup is
$F_{\text{fb},i} = -K_p\,e_{p_i} - K_d\,e_{v_i} - K_i\,e_{I_i}$,
with gains $K_p\!=\!\diag(6,6,8)$, $K_d\!=\!\diag(8,8,10)$, $K_i\!=\!\diag(0.1,0.1,0.2)$. Feedforward compensates gravity and nominal trajectory: $F_{\text{ff},i} = m_Q(a_{d_i} + ge_3)$.

Cable tension compensation prevents treating cable force as disturbance:
$F_{\text{cable},i} = \kappa_T(t)\,T_i\,q_i$,
where $\kappa_T(t) = \min\!\bigl(1,\,(t - t_{\text{taut},i})/\Delta_{\text{ramp}}\bigr)$,
with $t_{\text{taut},i}$ the time cable~$i$ reaches $T_i \geq 1.0$\,N and $\Delta_{\text{ramp}} = 2$\,s. The ramped gain uses only \emph{measured} cable force---no knowledge of $m_L$ or $N$ is required---preventing impulsive loading during the slack-to-taut transition while remaining fully decentralized.

Anti-swing control suppresses pendular oscillations on $\Sph^2$:
$F_{\text{swing},i} = k_q\,e_{q_i} - k_\omega\,\omega_{q_i}$,
with $k_q\!=\!4.0$, $k_\omega\!=\!2.0$~\cite{lee2018geometric}. Here $e_{q_i}$~\eqref{eq:eq} steers $q_i \to q_{d_i}$ along the geodesic and $\omega_{q_i} \in T_{q_i}\Sph^2$ is cable angular velocity. Together, these drive $\Psi_{q_i}$ monotonically toward zero in the absence of external perturbation. The ESO disturbance estimate (Layer~4) feeds forward as $F_{\text{eso},i} = m_Q\hat{d}_i$.

Desired rotation $R_{d_i} \in \SOthree$ is extracted from $F_{\text{des},i}$ by aligning the body $z$-axis with the thrust direction~\cite{lee2010geometric}:
\begin{equation}
  b_{3c} = \frac{F_{\text{des},i}}{\norm{F_{\text{des},i}}},\;\; b_{2c} = \frac{b_{3c} \times b_{1d}}{\norm{b_{3c} \times b_{1d}}},\;\; b_{1c} = b_{2c} \times b_{3c},
  \label{eq:Rd_extract}
\end{equation}
with $b_{1d} = [\cos\psi_d,\, \sin\psi_d,\, 0]^\top$ setting the desired heading.

\subsection{Layer 2: Geometric Attitude Control on SO(3)}

The inner attitude loop (200\,Hz) uses the geometric tracking controller~\cite{lee2010geometric}:
\begin{equation}
  \tau_i = -k_R\,e_{R_i} - k_\Omega\,e_{\Omega_i} + \Omega_i \times J\Omega_i,
  \label{eq:att_ctrl}
\end{equation}
with $k_R\!=\!8.0$, $k_\Omega\!=\!1.5$, and $e_{\Omega_i} = \Omega_i - R_i^\top R_{d_i}\Omega_{d_i}$. The first two terms provide PD control on $\SOthree$; the third compensates gyroscopic coupling. Feedforward terms $\hatmap{\Omega_i}R_i^\top R_{d_i}\Omega_{d_i} - R_i^\top R_{d_i}\dot{\Omega}_{d_i}$ are omitted under the assumption $\Omega_{d_i} \approx 0$, valid when desired thrust varies slowly relative to the 200\,Hz attitude bandwidth.

\begin{proposition}[Almost-global exponential stability~\cite{lee2010geometric}]\label{prop:lyap}
Define the Lyapunov function
\begin{equation}
  V_R = \tfrac{1}{2}k_R\,\Psi_{R_i} + \tfrac{1}{2}e_{\Omega_i}^\top J\,e_{\Omega_i} + c\,e_{R_i}^\top J\,e_{\Omega_i},
  \label{eq:VR}
\end{equation}
where $\Psi_{R_i} = \frac{1}{2}\tr(I - R_{d_i}^\top R_i)$ is the attitude configuration error and $c>0$ is sufficiently small. Under~\eqref{eq:att_ctrl} with $\Psi_{R_i}(0)<2$:
\begin{equation}
  \dot{V}_R \leq -\lambda_{\min}(W)\bigl(\norm{e_{R_i}}^2 + \norm{e_{\Omega_i}}^2\bigr),
  \label{eq:VR_dot}
\end{equation}
for a positive-definite $W = W(k_R, k_\Omega, J)$, yielding exponential convergence on the dense open set $\{\Psi_R < 2\} \subset \SOthree$.
\end{proposition}

\subsection{Layers 3--4: ESO and Mass Estimator}

\textit{Layer~4} is a third-order Extended State Observer (ESO) per translational axis, modeling dynamics as a double integrator with lumped disturbance $\ddot{p}_k = b_0 u_k + d_k(t)$, $b_0 = 1/m_Q$:
\begin{equation}
  \dot{\hat{z}}_{1k} = \hat{z}_{2k} + 3\omega_0\tilde{x}_k,\;\; \dot{\hat{z}}_{2k} = \hat{z}_{3k} + 3\omega_0^2\tilde{x}_k + b_0 u_k,\;\; \dot{\hat{z}}_{3k} = \omega_0^3\tilde{x}_k,
  \label{eq:eso}
\end{equation}
with $\tilde{x}_k = x_k - \hat{z}_{1k}$ and poles at $-\omega_0 = -50$\,rad/s (settling $\sim$0.1\,s). The disturbance estimate $\hat{d}_i = [\hat{z}_{3x}, \hat{z}_{3y}, \hat{z}_{3z}]^\top$ is saturated to $|\hat{d}_{i,k}| \leq 20$\,m/s$^2$ and fed forward via $F_{\text{eso},i}$. Under bounded $\dot{d}$, estimation error scales as $O(\sup|\dot{d}|/\omega_0)$~\cite{guo2013active}.

\textit{Layer~3} adaptively estimates the payload mass share $\hat{\theta}_i \approx m_L/N$ via concurrent learning~\cite{chowdhary2010concurrent}, providing gravity compensation $\hat{\theta}_i(ge_3 + \ddot{p}_d^L)$ to Layer~1.

\subsection{Cascade Stability and Fault Containment}

The cascade exploits timescale separation: attitude ($k_R/J \approx 200$\,rad/s) $\gg$ ESO ($\omega_0 = 50$\,rad/s) $\gg$ position ($\omega_p = \sqrt{K_p/m_Q} \approx 30$\,rad/s). Singular perturbation arguments guarantee composite stability when this bandwidth ratio exceeds a computable threshold~\cite{khalil2002nonlinear}. The hierarchy also provides fault containment: mass estimation errors (Layer~3) affect only feedforward in Layer~1 without corrupting attitude tracking; ESO transients are filtered before reaching attitude; CBF interventions are bounded by the tilt constraint (Section~\ref{sec:safety}). This modularity supports independent layer verification~\cite{koopman2017autonomous}.
